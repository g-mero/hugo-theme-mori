{{ define "main" }}
  {{ with .Content }}
    <div class="prose mb-xl fs-sm lh-relaxed sm:mb-2xl sm:fs-base">
      {{ . }}
    </div>
  {{ end }}

  <section class="posts">
    <h2 class="fs-base font-600 mb-md pb-xs border-b border-bd1 sm:fs-lg">{{ i18n "recent_posts" }}</h2>
    <ul class="list-none p-0 m-0">
      {{ range first 5 site.RegularPages }}
        <li class="flex flex-col gap-1 mb-md sm:flex-row sm:items-baseline sm:gap-sm sm:mb-sm">
          <time class="fs-xs c-fg4 font-mono sm:fs-sm sm:flex-shrink-0 sm:min-w-100px" datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "2006-01-02" }}
          </time>
          <a class="flex-1 c-fg2 border-b border-fg2 hover:border-transparent" href="{{ .RelPermalink }}">{{ .Title }}</a>
        </li>
      {{ end }}
    </ul>
    <a class="inline-block mt-md c-fg3 fs-xs hover:c-fg2 hover:b-b sm:fs-sm" href="{{ "posts" | relLangURL }}">{{ i18n "read_more" }} →</a>
  </section>

  {{ with site.Data.links }}
    {{ $settings := .settings }}
    {{ $showOnHome := default 6 $settings.showOnHome }}

    {{ if gt $showOnHome 0 }}
      {{/* Collect all groups from data/links/ directory */}}
      {{ $allGroups := slice }}
      {{ range $key, $value := . }}
        {{ if ne $key "settings" }}
          {{ $allGroups = $allGroups | append $value }}
        {{ end }}
      {{ end }}

      {{/* Merge groups with same name */}}
      {{ $groupsMap := dict }}
      {{ range $allGroups }}
        {{ $groupName := .name }}
        {{ if isset $groupsMap $groupName }}
          {{/* Merge items into existing group */}}
          {{ $existing := index $groupsMap $groupName }}
          {{ $mergedItems := $existing.items | append .items }}
          {{ $groupsMap = merge $groupsMap (dict $groupName (merge $existing (dict "items" $mergedItems))) }}
        {{ else }}
          {{/* Add new group */}}
          {{ $groupsMap = merge $groupsMap (dict $groupName .) }}
        {{ end }}
      {{ end }}

      {{/* Convert map back to slice */}}
      {{ $groups := slice }}
      {{ range $key, $value := $groupsMap }}
        {{ $groups = $groups | append $value }}
      {{ end }}

      {{/* Filter groups if homeGroups is specified */}}
      {{ $homeGroups := $settings.homeGroups }}
      {{ if $homeGroups }}
        {{ $filteredGroups := slice }}
        {{ range $groups }}
          {{ if in $homeGroups .name }}
            {{ $filteredGroups = $filteredGroups | append . }}
          {{ end }}
        {{ end }}
        {{ $groups = $filteredGroups }}
      {{ end }}

      {{/* Sort groups by weight */}}
      {{ $groups = sort $groups "weight" "asc" }}

      {{ if $groups }}
      <section class="mt-xl sm:mt-2xl">
        <h2 class="fs-base font-600 mb-md pb-xs border-b border-bd1 sm:fs-lg">{{ i18n "links" }}</h2>
        {{ partial "links-list.html" (dict "groups" $groups "limit" $showOnHome "showGroupName" false) }}
        <a class="inline-block mt-md c-fg3 fs-xs hover:c-fg2 hover:b-b sm:fs-sm" href="{{ "links" | relLangURL }}">{{ i18n "view_all" }} →</a>
      </section>
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

