{{ define "main" }}
  {{ with .Content }}
    <div class="prose mb-2xl">
      {{ . }}
    </div>
  {{ end }}

  <section class="mb-2xl">
    <h2 class="fs-lg mb-md pb-xs border-b border-bd1 c-main">{{ i18n "recent_posts" }}</h2>
    {{- $postsSection := site.Params.postsSection | default "posts" -}}
    {{- $posts := where site.RegularPages "Section" $postsSection -}}
    <ul class="list-none p-0 m-0">
      {{ range first 5 $posts }}
        <li class="flex flex-col gap-1 mb-md md:flex-row md:items-baseline md:gap-sm md:mb-sm">
          <time class="fs-sm c-fg4 font-mono md:flex-shrink-0 md:min-w-100px" datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "2006-01-02" }}
          </time>
          <a class="flex-1 c-fg2 border-b border-fg2 hover:border-transparent" href="{{ .RelPermalink }}">{{ .Title }}</a>
        </li>
      {{ end }}
    </ul>
    <a class="inline-block mt-md c-fg3 hover:c-fg2 hover:b-b fs-sm" href="{{ $postsSection | relLangURL }}">{{ i18n "view_all" }} <span class="icon i-arrow-right"></span></a>
  </section>

  {{ with site.Data.links }}
    {{ $settings := .settings }}
    {{ $showOnHome := default 6 $settings.showOnHome }}

    {{ if gt $showOnHome 0 }}
      {{/* Collect all groups from data/links/ directory */}}
      {{ $allGroups := slice }}
      {{ range $key, $value := . }}
        {{ if ne $key "settings" }}
          {{ $allGroups = $allGroups | append $value }}
        {{ end }}
      {{ end }}

      {{/* Merge groups with same name */}}
      {{ $groupsMap := dict }}
      {{ range $allGroups }}
        {{ $groupName := .name }}
        {{ if isset $groupsMap $groupName }}
          {{/* Merge items into existing group */}}
          {{ $existing := index $groupsMap $groupName }}
          {{ $mergedItems := $existing.items | append .items }}
          {{ $groupsMap = merge $groupsMap (dict $groupName (merge $existing (dict "items" $mergedItems))) }}
        {{ else }}
          {{/* Add new group */}}
          {{ $groupsMap = merge $groupsMap (dict $groupName .) }}
        {{ end }}
      {{ end }}

      {{/* Convert map back to slice */}}
      {{ $groups := slice }}
      {{ range $key, $value := $groupsMap }}
        {{ $groups = $groups | append $value }}
      {{ end }}

      {{/* Filter groups if homeGroups is specified */}}
      {{ $homeGroups := $settings.homeGroups }}
      {{ if $homeGroups }}
        {{ $filteredGroups := slice }}
        {{ range $groups }}
          {{ if in $homeGroups .name }}
            {{ $filteredGroups = $filteredGroups | append . }}
          {{ end }}
        {{ end }}
        {{ $groups = $filteredGroups }}
      {{ end }}

      {{/* Sort groups by weight */}}
      {{ $groups = sort $groups "weight" "asc" }}

      {{ if $groups }}
      <section class="mb-2xl">
        <h2 class="fs-lg mb-md pb-xs border-b border-bd1 c-main">{{ i18n "links" }}</h2>
        {{ partial "links-list.html" (dict "groups" $groups "limit" $showOnHome "showGroupName" false) }}
        <a class="inline-block mt-md c-fg3 fs-sm hover:c-fg2 hover:b-b" href="{{ "links" | relLangURL }}">{{ i18n "view_all" }} <span class="icon i-arrow-right"></span></a>
      </section>
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

