{{ define "main" }}
  {{- $authors := partial "get-authors.html" . }}

  <article>
    <header class="mb-lg sm:mb-xl">
      <h1 class="fs-lg font-600 m-0 mb-xs lh-tight break-all sm:fs-2xl">{{ .Title }}</h1>
      <div class="flex items-center flex-wrap fs-xs c-fg4 font-mono sm:fs-sm">
        {{- if gt (len $authors) 0 }}
          <span class="flex whitespace-nowrap">
            {{- range $index, $author := $authors -}}
              {{- if $author.website }}
                <a href="{{ $author.website }}" class="c-fg3 font-500 no-underline hover:underline border-none" target="_blank" rel="noopener noreferrer">{{ $author.name }}</a>
              {{- else }}
                <span class="c-fg3 font-500">{{ $author.name }}</span>
              {{- end }}
              {{- if lt (add $index 1) (len $authors) }}<span class="opacity-60">,</span>{{ end }}
            {{- end }}
          </span>
          <span class="opacity-60">·</span>
        {{- end }}

        <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
          {{ .Date.Format "Jan 2, 2006" }}
        </time>
        {{- if ne (.Date.Format "2006-01-02") (.Lastmod.Format "2006-01-02") }}
          <span class="opacity-60">·</span>
          <time datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
            Updated {{ .Lastmod.Format "Jan 2, 2006" }}
          </time>
        {{- end }}
      </div>
    </header>

    <div class="mb-lg sm:mb-xl">
      {{ .Content }}
    </div>

    <div class="mt-xl pt-sm b-t b-bd1 flex flex-col items-stretch gap-sm sm:flex-row sm:justify-between sm:items-start sm:pt-md sm:flex-wrap">
      {{ with .Params.tags }}
        <div class="flex flex-wrap gap-xs items-start">
          {{ range . }}
            <a href="{{ "tags" | relURL }}/{{ . | urlize }}/" class="inline-block c-fg3 fs-sm b-none hover:c-fg2 truncate">#{{ . }}</a>
          {{ end }}
        </div>
      {{ end }}

      {{ $section := .Section }}
      {{ $pages := where .Site.RegularPages "Section" $section }}
      {{ $currentIndex := 0 }}
      {{ range $index, $page := $pages }}
        {{ if eq $page.RelPermalink $.RelPermalink }}
          {{ $currentIndex = $index }}
        {{ end }}
      {{ end }}

      {{ $prevIndex := sub $currentIndex 1 }}
      {{ $nextIndex := add $currentIndex 1 }}
      {{ if lt $prevIndex 0 }}
        {{ $prevIndex = sub (len $pages) 1 }}
      {{ end }}
      {{ if ge $nextIndex (len $pages) }}
        {{ $nextIndex = 0 }}
      {{ end }}

      {{ $prev := index $pages $prevIndex }}
      {{ $next := index $pages $nextIndex }}

      {{ if not .Params.tags }}
        {{/* No tags: show prev on left, next on right */}}
        {{/* If prev and next are the same (only one article), show only next */}}
        {{ if and $prev $next (eq $prev.RelPermalink $next.RelPermalink) }}
          <nav class="flex w-full">
            <div class="flex-1"></div>
            <div class="flex-1 text-right overflow-hidden">
              <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:c-fg2" title="{{ $next.Title }}">{{ $next.Title }} →</a>
            </div>
          </nav>
        {{ else }}
          <nav class="flex w-full gap-md">
            <div class="flex-1 text-left overflow-hidden">
              {{ if $prev }}
                <a href="{{ $prev.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:c-fg2" title="{{ $prev.Title }}">← {{ $prev.Title }}</a>
              {{ end }}
            </div>
            <div class="flex-1 text-right overflow-hidden">
              {{ if $next }}
                <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:c-fg2" title="{{ $next.Title }}">{{ $next.Title }} →</a>
              {{ end }}
            </div>
          </nav>
        {{ end }}
      {{ else }}
        {{/* Has tags: show only next on right */}}
        {{ if $next }}
          <nav class="flex-shrink-0 text-left max-w-full sm:text-right sm:max-w-50%">
            <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:c-fg2" title="{{ $next.Title }}">{{ $next.Title }} →</a>
          </nav>
        {{ end }}
      {{ end }}
    </div>
  </article>

  {{ if templates.Exists "_partials/after-article.html" }}
    {{ partialCached "after-article.html" . }}
  {{ end }}
{{ end }}
