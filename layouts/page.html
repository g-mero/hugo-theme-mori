{{ define "main" }}
  <article>
    {{ partial "page-header.html" (dict "context" . "title" .Title "categories" (.GetTerms "categories") "meta" (partial "article-meta.html" .)) }}

    <div class="mb-lg md:mb-xl">
      {{ .Content }}
    </div>

    <div class="mt-xl pt-sm b-t b-bd1 flex flex-col items-stretch gap-sm md:flex-row md:justify-between md:items-start md:pt-md md:flex-wrap">
      {{ with .GetTerms "tags" }}
        <div class="flex flex-wrap gap-xs items-start">
          {{ range . }}
            <a href="{{ .RelPermalink }}" class="inline-block c-fg3 fs-sm b-none hover:c-fg2 truncate">#{{ .LinkTitle  }}</a>
          {{ end }}
        </div>
      {{ end }}

      {{ $section := .Section }}
      {{ $pages := where .Site.RegularPages "Section" $section }}
      {{ $currentIndex := 0 }}
      {{ range $index, $page := $pages }}
        {{ if eq $page.RelPermalink $.RelPermalink }}
          {{ $currentIndex = $index }}
        {{ end }}
      {{ end }}

      {{ $prevIndex := sub $currentIndex 1 }}
      {{ $nextIndex := add $currentIndex 1 }}
      {{ if lt $prevIndex 0 }}
        {{ $prevIndex = sub (len $pages) 1 }}
      {{ end }}
      {{ if ge $nextIndex (len $pages) }}
        {{ $nextIndex = 0 }}
      {{ end }}

      {{ $prev := index $pages $prevIndex }}
      {{ $next := index $pages $nextIndex }}

      {{ if not .Params.tags }}
        {{/* No tags: show prev on left, next on right */}}
        {{/* If prev and next are the same (only one article), show only next */}}
        {{ if and $prev $next (eq $prev.RelPermalink $next.RelPermalink) }}
          <nav class="flex w-full">
            <div class="flex-1"></div>
            <div class="flex-1 text-right overflow-hidden">
              <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
            </div>
          </nav>
        {{ else }}
          <nav class="flex w-full gap-md">
            <div class="flex-1 text-left overflow-hidden">
              {{ if $prev }}
                <a href="{{ $prev.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $prev.Title }}"><span class="icon i-arrow-left"></span> {{ $prev.Title }}</a>
              {{ end }}
            </div>
            <div class="flex-1 text-right overflow-hidden">
              {{ if $next }}
                <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
              {{ end }}
            </div>
          </nav>
        {{ end }}
      {{ else }}
        {{/* Has tags: show only next on right */}}
        {{ if $next }}
          <nav class="flex-shrink-0 text-left max-w-full md:text-right md:max-w-50%">
            <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
          </nav>
        {{ end }}
      {{ end }}
    </div>
  </article>

  {{ if templates.Exists "_partials/after-article.html" }}
    {{ partialCached "after-article.html" . }}
  {{ end }}
{{ end }}
