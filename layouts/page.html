{{ define "main" }}
  {{- $authors := partial "get-authors.html" . }}

  <article>
    <header class="mb-lg md:mb-xl mt-xl">
      <div class="mb-sm">
        <a class="fs-base border-none inline c-main" href="{{relLangURL ""}}" ><span class="icon i-arrow-left-alt"></span>Back</a>
        {{with .GetTerms "categories"}}
          {{range .}}
          <a class="fs-sm c-fg2 border-none inline-flex items-center bg-bg1 px-2 py-1 rounded-lg ml-xs md:ml-sm" href="{{.RelPermalink}}" >{{.LinkTitle}}</a>
          {{end}}
        {{end}}
      </div>
      <h1 class="fs-lg font-600 m-0 mb-xs lh-tight break-all md:fs-xl">{{ .Title }}</h1>
      <div class="fs-sm c-fg3 font-mono">
        {{- if gt (len $authors) 0 }}
          <span>
            {{- range $index, $author := $authors -}}
              {{- if $author.website }}
                <a href="{{ $author.website }}" class="c-fg3 font-500 no-underline hover:underline border-none" target="_blank" rel="noopener noreferrer">{{ $author.name }}</a>
              {{- else }}
                <span class="c-fg3 font-500">{{ $author.name }}</span>
              {{- end }}
              {{- if lt (add $index 1) (len $authors) }}<span class="opacity-60">,</span>{{ end }}
            {{- end }}
          </span>
          <span class="opacity-60">·</span>
        {{- end }}

        <time class="inline" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
          {{ .Date.Format "Jan 2, 2006" }}
        </time>
        {{- if ne (.Date.Format "2006-01-02") (.Lastmod.Format "2006-01-02") }}
          <span class="opacity-60">·</span>
          <time class="inline" datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
            Updated {{ .Lastmod.Format "Jan 2, 2006" }}
          </time>
        {{- end }}

        {{ if .IsTranslated }}
        <ul class="inline lang-switcher mb-0! pl-0!">
          {{ range $index, $lang := .Translations }}
          <li class="mr-sm inline">
            <a href="{{ $lang.RelPermalink }}" class="c-fg3 border-none fs-xs hover:c-fg2">{{ $lang.Language.LanguageName }}</a>
          </li>
          {{ end }}
        </ul>
        {{ end }}

      </div>
    </header>

    <div class="mb-lg md:mb-xl">
      {{ .Content }}
    </div>

    <div class="mt-xl pt-sm b-t b-bd1 flex flex-col items-stretch gap-sm md:flex-row md:justify-between md:items-start md:pt-md md:flex-wrap">
      {{ with .GetTerms "tags" }}
        <div class="flex flex-wrap gap-xs items-start">
          {{ range . }}
            <a href="{{ .RelPermalink }}" class="inline-block c-fg3 fs-sm b-none hover:c-fg2 truncate">#{{ .LinkTitle  }}</a>
          {{ end }}
        </div>
      {{ end }}

      {{ $section := .Section }}
      {{ $pages := where .Site.RegularPages "Section" $section }}
      {{ $currentIndex := 0 }}
      {{ range $index, $page := $pages }}
        {{ if eq $page.RelPermalink $.RelPermalink }}
          {{ $currentIndex = $index }}
        {{ end }}
      {{ end }}

      {{ $prevIndex := sub $currentIndex 1 }}
      {{ $nextIndex := add $currentIndex 1 }}
      {{ if lt $prevIndex 0 }}
        {{ $prevIndex = sub (len $pages) 1 }}
      {{ end }}
      {{ if ge $nextIndex (len $pages) }}
        {{ $nextIndex = 0 }}
      {{ end }}

      {{ $prev := index $pages $prevIndex }}
      {{ $next := index $pages $nextIndex }}

      {{ if not .Params.tags }}
        {{/* No tags: show prev on left, next on right */}}
        {{/* If prev and next are the same (only one article), show only next */}}
        {{ if and $prev $next (eq $prev.RelPermalink $next.RelPermalink) }}
          <nav class="flex w-full">
            <div class="flex-1"></div>
            <div class="flex-1 text-right overflow-hidden">
              <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
            </div>
          </nav>
        {{ else }}
          <nav class="flex w-full gap-md">
            <div class="flex-1 text-left overflow-hidden">
              {{ if $prev }}
                <a href="{{ $prev.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $prev.Title }}"><span class="icon i-arrow-left"></span> {{ $prev.Title }}</a>
              {{ end }}
            </div>
            <div class="flex-1 text-right overflow-hidden">
              {{ if $next }}
                <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
              {{ end }}
            </div>
          </nav>
        {{ end }}
      {{ else }}
        {{/* Has tags: show only next on right */}}
        {{ if $next }}
          <nav class="flex-shrink-0 text-left max-w-full md:text-right md:max-w-50%">
            <a href="{{ $next.RelPermalink }}" class="inline-block c-fg3 fs-sm b-none max-w-full truncate hover:op-60" title="{{ $next.Title }}">{{ $next.Title }} <span class="icon i-arrow-right"></span></a>
          </nav>
        {{ end }}
      {{ end }}
    </div>
  </article>

  {{ if templates.Exists "_partials/after-article.html" }}
    {{ partialCached "after-article.html" . }}
  {{ end }}
{{ end }}
